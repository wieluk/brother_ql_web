{% extends "base.html" %}

{% block app_content %}
<div class="row">
    <!-- Settings buttons only (dark mode toggle moved to navbar) -->
    <div style="position: absolute; top: 10px; right: 20px; z-index: 1000; display: flex; gap: 10px; align-items: center;">
        <div class="btn-group btn-group-sm" role="group" aria-label="Settings">
        </div>
    </div>
    <div class="col-lg-3 col-md-4">
    <fieldset>
            <div class="accordion" id="accordion" style="max-height: 90vh; overflow-y: auto;">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingLabelSize">
                        <button class="accordion-button collapsed d-flex justify-content-between align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#accordionLabelSize" aria-expanded="false" aria-controls="accordionLabelSize">
                            <span>
                                <span class="fas fa-file" aria-hidden="true"></span> Label Size
                            </span>
                            <span id="labelMismatchIcon" class="text-danger ms-2" style="display: none;">
                                <span class="fas fa-exclamation-triangle" aria-hidden="true"></span>
                            </span>
                        </button>
                    </h2>
                    <div id="accordionLabelSize" class="accordion-collapse collapse" aria-labelledby="headingLabelSize" data-bs-parent="#accordion">
                        <div class="accordion-body">
                            <label for="label_size" style="margin-bottom: 0">Label Size:</label>
                            <select class="form-control form-select" id="label_size" onChange="preview()" data-default="{{default_label_size}}">
                                {% for label_size in label_sizes %}<option value="{{label_size[0]}}" data-x="{{label_size[3][0]}}"
                                    data-y="{{label_size[3][1]}}" data-round="{{label_size[2]}}" {% if default_label_size==label_size[0]
                                    %}selected{% endif %}>{{label_size[1]}}</option>{% endfor %}
                            </select>
                            <div class="form-text text-muted">Detected label: <span id="label-width">???</span> x <span id="label-height">???</span></div>
                            <div id="labelMismatch" class="form-text text-danger" style="display: none;">Label size mismatch detected!</div>

                            <label for="orientation" class="form-label input-group" style="margin-top: 10px; margin-bottom: 0">Label Orientation:</label>
                            <div class="btn-group mb-2" role="radiogroup" aria-label="Label Orientation">
                                <input type="radio" class="btn-check" name="orientation" id="orientation_standard" autocomplete="off" value="standard" onchange="preview()" {% if default_orientation=='standard' %}checked data-default="1"{% endif %}>
                                <label class="btn btn-secondary" for="orientation_standard">
                                    <span class="fas fa-ruler-horizontal" aria-hidden="true"></span> Standard
                                </label>
                                <input type="radio" class="btn-check" name="orientation" id="orientation_rotated" autocomplete="off" value="rotated" onchange="preview()" {% if default_orientation=='rotated' %}checked data-default="1"{% endif %}>
                                <label class="btn btn-secondary" for="orientation_rotated">
                                    <span class="fas fa-ruler-vertical" aria-hidden="true"></span> Rotated
                                </label>
                            </div>
                                <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" onchange="preview()" id="high_res" data-default="1">
                                <label class="form-check-label" for="high_res">
                                    High-resolution printing (600 dpi)
                                </label>
                            </div>
                        </div>
                        <!-- class="accordion-body" -->
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFontSettings">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#accordionFontSettings" aria-expanded="true" aria-controls="accordionFontSettings">
                            <span class="fas fa-font" aria-hidden="true"></span> Font Settings
                        </button>
                    </h2>
                    <div id="accordionFontSettings" class="accordion-collapse collapse show" aria-labelledby="headingFontSettings" data-bs-parent="#accordion">
                        <div class="accordion-body">
                            <div id="fontSettingsLineSelector">
                                <label for="lineSelect" style="margin-bottom: 0">Select Line:</label>
                                <select class="form-control form-select" id="lineSelect">
                                </select>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" data-default="1" id="sync_font_settings" checked>
                                <label class="form-check-label" for="sync_font_settings">
                                    Use same font for all lines
                                </label>
                            </div>

                            <div id="fontSettingsContainer">
                                <div id="fontSetting">
                                    <label for="font" style="margin-bottom: 0">Font:</label>
                                    <select class="form-control form-select" id="font" onChange="preview()">
                                        {% for font in fonts %}
                                        <optgroup label="{{font.family}}">
                                        {% for style in font.styles %}
                                        <option value="{{font.family}},{{style}}">{{font.family}} ({{style}})</option>
                                        {% endfor %}
                                        </optgroup>
                                        {% endfor %}
                                    </select>

                                    <label for="font_size" style="margin-top: 10px; margin-bottom: 0">Font Size:</label>
                                    <input id="font_size" class="form-control" type="number" min="1" data-default="{{default_font_size}}"
                                        onChange="preview()" required>

                                    <label for="font_align" class="form-label input-group" style="margin-top: 10px; margin-bottom: 0">Font
                                        Alignment:</label>
                                    <div class="btn-group" role="radiogroup" aria-label="Font Alignment">
                                        <input type="radio" class="btn-check" name="font_align" id="font_align_left" autocomplete="off" value="left"
                                            onchange="preview()" aria-label="Left Align">
                                        <label class="btn btn-secondary" for="font_align_left"><span class="fas fa-align-left"
                                                aria-hidden="true"></span></label>
                                        <input type="radio" class="btn-check" name="font_align" id="font_align_center" autocomplete="off" value="center"
                                            onchange="preview()" aria-label="Center Align" checked data-default="1">
                                        <label class="btn btn-secondary" for="font_align_center"><span class="fas fa-align-center"
                                                aria-hidden="true"></span></label>
                                        <input type="radio" class="btn-check" name="font_align" id="font_align_right" autocomplete="off" value="right"
                                            onchange="preview()" aria-label="Right Align">
                                        <label class="btn btn-secondary" for="font_align_right"><span class="fas fa-align-right"
                                                aria-hidden="true"></span></label>
                                    </div>

                                    <label for="line_spacing" class="form-label input-group" style="margin-top: 10px; margin-bottom: 0">Line
                                        Spacing:</label>
                                    <div class="btn-group mb-3" role="radiogroup" aria-label="Line Spacing">
                                        {% for line_spacing in line_spacings %}
                                        <input type="radio" class="btn-check" name="line_spacing" id="line_spacing{{line_spacing}}" autocomplete="off"
                                            value="{{line_spacing}}" onchange="preview()" aria-label="{{line_spacing}}%" {% if
                                            default_line_spacing==line_spacing %}checked data-default="1" {% endif %}>
                                        <label class="btn btn-secondary" for="line_spacing{{line_spacing}}">{{line_spacing}}%</label>
                                        {% endfor %}
                                    </div>
                                    <h6>Additional Font Options:</h6>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" onchange="preview()" id="font_inverted" data-default="0">
                                        <label class="form-check-label" for="font_inverted">
                                            Invert text
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" onchange="preview()" id="font_checkbox" data-default="0">
                                        <label class="form-check-label" for="font_checkbox">
                                            TODO item (checkbox)
                                        </label>
                                    </div>
                                    <div class="red-support">
                                        <label for="print_color" class="form-label input-group" style="margin-top: 10px; margin-bottom: 0">Print
                                            Color:</label>
                                        <div class="btn-group">
                                            <label class="btn btn-dark" id="print_color_black">
                                                <input type="radio" name="print_color" onchange="preview()" value="black" aria-label="Black" data-default="1">Black
                                            </label>
                                            <label class="btn btn-danger" id="print_color_red">
                                                <input type="radio" name="print_color" onchange="preview()" value="red" aria-label="Red">Red
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <!-- class="accordion-body" -->
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingCodeSettings">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordionCodeSettings" aria-expanded="false" aria-controls="accordionCodeSettings">
                            <span class="fas fa-qrcode" aria-hidden="true"></span> Code Settings
                        </button>
                    </h2>
                    <div id="accordionCodeSettings" class="accordion-collapse collapse" aria-labelledby="headingCodeSettings" data-bs-parent="#accordion">
                        <div class="accordion-body">
                            <label for="barcode_type" style="margin-bottom: 0">Barcode Type:</label>
                            <select class="form-control form-select" id="barcode_type" onChange="preview()"></select>

                            <div id="qrCodeSizeContainer">
                                <label for="qrcode_size" style="margin-top: 10px; margin-bottom: 0">QR Code Size:</label>
                                <input id="qrcode_size" class="form-control" type="number" min="1" data-default="{{default_qr_size}}"
                                    onChange="preview()"
                                    required>
                            </div>

                            <div id="qrCodeCorrectionContainer">
                                <label for="qrcode_correction" style="margin-top: 10px; margin-bottom: 0">Error Correction:</label>
                                <select class="form-control form-select" id="qrcode_correction" onChange="preview()">
                                    <option value="L">About 7% can be corrected.</option>
                                    <option value="M">About 15% can be corrected.</option>
                                    <option value="Q">About 25% can be corrected.</option>
                                <option value="H">About 30% can be corrected.</option>
                            </select>
                        </div>
                        <label for="code_text" style="margin-top: 10px; margin-bottom: 0">Code Content:</label>
                        <textarea rows="3" id="code_text" class="form-control" onChange="preview()" onInput="preview()"
                            data-default=""></textarea>
                        <div class="form-text text-muted">If filled, this will be used for generating barcodes/QR codes instead of the label
                            text.</div>
                        <!-- class="accordion-body" -->
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingImageSettings">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordionImageSettings" aria-expanded="false" aria-controls="accordionImageSettings">
                            <span class="fas fa-image" aria-hidden="true"></span> Image Settings
                        </button>
                    </h2>
                    <div id="accordionImageSettings" class="accordion-collapse collapse" aria-labelledby="headingImageSettings" data-bs-parent="#accordion">
                        <div class="accordion-body">
                            <label for="image_mode" class="form-label input-group" style="margin-top: 10px; margin-bottom: 0">Image mode:</label>
                            <div class="btn-group mb-2" role="radiogroup" aria-label="Image Mode">
                                <input type="radio" class="btn-check" name="image_mode" id="image_mode_colored" autocomplete="off" value="colored"
                                    onchange="preview()" aria-label="Colored" {% if default_image_mode=='colored' %}checked{% endif %}>
                                <label class="btn btn-secondary" for="image_mode_colored" data-bs-toggle="tooltip" title="Full color mode">
                                    <span class="fa-solid fa-palette" aria-hidden="true"></span><br/>Color
                                </label>
                                <input type="radio" class="btn-check" name="image_mode" id="image_mode_bw" autocomplete="off" value="black_and_white"
                                    onchange="preview()" aria-label="Black & White" {% if default_image_mode=='black_and_white' %}checked{% endif %}>
                                <label class="btn btn-secondary" for="image_mode_bw" data-bs-toggle="tooltip" title="Black & White mode">
                                    <span class="fa-solid fa-circle-half-stroke" aria-hidden="true"></span><br/>B/W
                                </label>
                                <input type="radio" class="btn-check" name="image_mode" id="image_mode_red_and_black" autocomplete="off"
                                    value="red_and_black" onchange="preview()" aria-label="Red & Black & White" {% if
                                    default_image_mode=='red_and_black' %}checked{% endif %}>
                                <label class="btn btn-secondary" for="image_mode_red_and_black" data-bs-toggle="tooltip" title="Red, Black & White mode">
                                    <span class="fa-solid fa-droplet" style="color: #d32f2f;" aria-hidden="true"></span>
                                    <span class="fa-solid fa-droplet" style="color: #222;" aria-hidden="true"></span><br/>R/B/W
                                </label>
                                <input type="radio" class="btn-check" name="image_mode" id="image_mode_grayscale" autocomplete="off" value="grayscale"
                                    onchange="preview()" aria-label="Grayscale" {% if default_image_mode=='grayscale' %}checked data-default="1" {%
                                    endif %}>
                                <label class="btn btn-secondary" for="image_mode_grayscale" data-bs-toggle="tooltip" title="Grayscale mode">
                                    <span class="fa-solid fa-grip-lines-vertical" aria-hidden="true"></span><br/>Grayscale
                                </label>
                            </div>

                            <div class="form-check my-2">
                                <input class="form-check-input" type="checkbox" value="1" onchange="preview()" id="image_fit" checked>
                                <label class="form-check-label" for="image_fit">
                                    Auto-fit image to label
                                </label>
                            </div>
                            <div class="mb-2">
                                <label for="image_scaling_factor" class="form-label">Image scaling factor (%):</label>
                                <input type="number" class="form-control" id="image_scaling_factor" min="1" max="500" value="100" data-default="100"
                                    oninput="preview()" />
                                <div class="form-text">Only used if auto-fit is <b>not</b> enabled.</div>
                            </div>
                            <div class="mb-2">
                                <label for="image_rotation" class="form-label">Image rotation (degrees):</label>
                                <input type="number" class="form-control" id="image_rotation" min="0" max="360" value="0" data-default="0"
                                    oninput="preview()" />
                                <div class="form-text">Rotate the image by the specified angle.</div>
                            </div>

                            <label for="image_bw_threshold" style="margin-top: 10px; margin-bottom: 0">Black & White threshold:</label>
                            <div class="input-group">
                                <input id="image_bw_threshold" class="form-control" type="number" min="1" max="255"
                                    data-default="{{default_bw_threshold}}" onChange="preview()">
                                <span class="input-group-text" id="threshold-addon">%</span>
                            </div>
                        </div>
                        <!-- class="accordion-body" -->
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingMarginsBorders">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordionMarginsBorders" aria-expanded="false" aria-controls="accordionMarginsBorders">
                            <span class="fas fa-arrows-alt" aria-hidden="true"></span> Margins and Borders
                        </button>
                    </h2>
                    <div id="accordionMarginsBorders" class="accordion-collapse collapse" aria-labelledby="headingMarginsBorders" data-bs-parent="#accordion">
                        <div class="accordion-body">
                            <label for="margin_top" style="margin-bottom: 0">Margin Top:</label>
                            <div class="input-group marginsTopBottom">
                                <input id="margin_top" class="form-control marginsTopBottom" type="number" min="0" max="200"
                                    data-default="{{default_margin_top}}" onChange="preview()" aria-describedby="marginTop-addon" required>
                                <span class="input-group-text" id="marginTop-addon">px</span>
                            </div>
                            <label for="margin_bottom" style="margin-top: 10px; margin-bottom: 0">Margin Bottom:</label>
                            <div class="input-group marginsTopBottom">
                                <input id="margin_bottom" class="form-control marginsTopBottom" type="number" min="0" max="200"
                                    data-default="{{default_margin_bottom}}" onChange="preview()" aria-describedby="marginBottom-addon" required>
                                <span class="input-group-text" id="marginBottom-addon">px</span>
                            </div>
                            <label for="margin_left" style="margin-top: 10px; margin-bottom: 0">Margin Left:</label>
                            <div class="input-group marginsLeftRight">
                                <input id="margin_left" class="form-control marginsLeftRight" type="number" min="0" max="200"
                                    data-default="{{default_margin_left}}" onChange="preview()" aria-describedby="marginLeft-addon" required>
                                <span class="input-group-text" id="marginLeft-addon">px</span>
                            </div>
                            <label for="margin_right" style="margin-top: 10px; margin-bottom: 0">Margin Right:</label>
                            <div class="input-group marginsLeftRight">
                                <input id="margin_right" class="form-control marginsLeftRight" type="number" min="0" max="200"
                                    data-default="{{default_margin_right}}" onChange="preview()" aria-describedby="marginRight-addon" required>
                                <span class="input-group-text" id="marginRight-addon">px</span>
                            </div>

                            <hr style="margin: 1.2em 0;" />

                            <label for="border_thickness" style="margin-bottom: 0">Border Thickness (0 = disabled):</label>
                            <div class="input-group">
                                <input id="border_thickness" class="form-control" type="number" min="0" data-default="0" onChange="preview()" />
                                <span class="input-group-text" id="marginBottom-addon">px</span>
                            </div>
                            <label for="border_roundness" style="margin-bottom: 0">Border Roundness:</label>
                            <div class="input-group">
                                <input id="border_roundness" class="form-control" type="number" min="0" data-default="0" onChange="preview()" />
                                <span class="input-group-text" id="marginBottom-addon">px</span>
                            </div>
                            <label for="border_distance_x" style="margin-bottom: 0">Border Distance (left/right):</label>
                            <div class="input-group">
                                <input id="border_distance_x" class="form-control" type="number" min="0" data-default="0" onChange="preview()" />
                                <span class="input-group-text" id="marginBottom-addon">px</span>
                            </div>
                            <label for="border_distance_y" style="margin-bottom: 0">Border Distance (top/bottom):</label>
                            <div class="input-group">
                                <input id="border_distance_y" class="form-control" type="number" min="0" data-default="0" onChange="preview()" />
                                <span class="input-group-text" id="marginBottom-addon">px</span>
                            </div>

                            <div class="red-support">
                                <label for="border_color" class="form-label input-group" style="margin-top: 10px; margin-bottom: 0">Print
                                    Color:</label>
                                <div class="btn-group">
                                    <label class="btn btn-dark" id="border_color_black">
                                        <input type="radio" name="border_color" onchange="preview()" value="black" aria-label="Black" data-default="1">Black
                                    </label>
                                    <label class="btn btn-danger" id="border_color_red">
                                        <input type="radio" name="border_color" onchange="preview()" value="red" aria-label="Red">Red
                                    </label>
                                </div>
                            </div>
                        </div>
                        <!-- class="accordion-body" -->
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingAdvancedSettings">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordionAdvancedSettings" aria-expanded="false" aria-controls="accordionAdvancedSettings">
                            <span class="fas fa-wrench" aria-hidden="true"></span> Advanced Settings
                        </button>
                    </h2>
                    <div id="accordionAdvancedSettings" class="accordion-collapse collapse" aria-labelledby="headingAdvancedSettings" data-bs-parent="#accordion">
                        <div class="accordion-body">
                            <label for="log_level" style="margin-bottom: 0">Log Level:</label>
                            <select class="form-control form-select mb-3" id="log_level" onChange="preview()">
                                <option value="CRITICAL">CRITICAL</option>
                                <option value="ERROR">ERROR</option>
                                <option value="WARNING" selected>WARNING</option>
                                <option value="INFO">INFO</option>
                                <option value="DEBUG">DEBUG</option>
                            </select>
                        </div>
                        <!-- class="accordion-body" -->
                    </div>
                </div>
            </div>
        </fieldset>
    </div>
    <div class="col-lg-5 col-md-4">
        <label for="print_type" class="form-label input-group" style="margin-bottom: 0">Print Type:</label>
        <div class="btn-group print-type-group" role="radiogroup" aria-label="Print Type">
            <input type="radio" class="btn-check" name="print_type" id="printTypeText" autocomplete="off" value="text"
                onchange="preview()" aria-label="Text" data-default="1" {% if default_print_type=='text' %}checked{% endif %}>
            <label class="btn btn-outline-primary" for="printTypeText"><span class="fas fa-font fa-lg" aria-hidden="true"></span><br>Text</label>
            <input type="radio" class="btn-check" name="print_type" id="printTypeQrCode" autocomplete="off" value="qrcode"
                onchange="preview()" aria-label="Code" {% if default_print_type=='qrcode' %}checked{% endif %}>
            <label class="btn btn-outline-primary" for="printTypeQrCode"><span class="fas fa-qrcode fa-lg" aria-hidden="true"></span><br>Code</label>
            <input type="radio" class="btn-check" name="print_type" id="printTypeQrCodeText" autocomplete="off" value="qrcode_text"
                onchange="preview()" aria-label="Code+Text" {% if default_print_type=='qrcode_text' %}checked{% endif %}>
            <label class="btn btn-outline-primary" for="printTypeQrCodeText"><span class="fas fa-barcode fa-lg" aria-hidden="true"></span><br>Code+Text</label>
            <input type="radio" class="btn-check" name="print_type" id="printTypeImage" autocomplete="off" value="image"
                onchange="preview()" aria-label="Image" {% if default_print_type=='image' %}checked{% endif %}>
            <label class="btn btn-outline-primary" for="printTypeImage"><span class="fas fa-image fa-lg" aria-hidden="true"></span><br>Image</label>
            <input type="radio" class="btn-check" name="print_type" id="printTypeShipping" autocomplete="off" value="shipping"
                onchange="preview()" aria-label="Shipping" {% if default_print_type=='shipping' %}checked{% endif %}>
            <label class="btn btn-outline-primary" for="printTypeShipping"><span class="fas fa-truck fa-lg" aria-hidden="true"></span><br>Shipping</label>
        </div>

        <fieldset id="groupLabelImage">
            <label style="margin-top: 10px; margin-bottom: 0">Label Image:</label>
            <form class="dropzone" id="image-dropzone">
            </form>
        </fieldset>
        <fieldset id="groupShipping" style="display:none">
            <div class="card mt-2">
                <div class="card-header"><span class="fas fa-arrow-up fa-xs me-1"></span> From / Sender</div>
                <div class="card-body pb-2">
                    <input class="form-control form-control-sm mb-2" id="ship_from_label"    data-default="" placeholder='Section header (default "From:")' onchange="preview()" oninput="preview()">
                    <input class="form-control mb-2" id="ship_sender_name"     data-default="" placeholder="Name"            onchange="preview()" oninput="preview()">
                    <input class="form-control mb-2" id="ship_sender_street"   data-default="" placeholder="Street + No."    onchange="preview()" oninput="preview()">
                    <input class="form-control mb-2" id="ship_sender_zip_city" data-default="" placeholder="ZIP + City"      onchange="preview()" oninput="preview()">
                    <input class="form-control"      id="ship_sender_country"  data-default="" placeholder="Country"         onchange="preview()" oninput="preview()">
                </div>
            </div>
            <div class="card mt-2">
                <div class="card-header"><span class="fas fa-arrow-down fa-xs me-1"></span> To / Recipient</div>
                <div class="card-body pb-2">
                    <input class="form-control form-control-sm mb-2" id="ship_to_label"      data-default="" placeholder='Section header (default "To:")'   onchange="preview()" oninput="preview()">
                    <input class="form-control mb-2" id="ship_recip_company"  data-default="" placeholder="Company (optional)" onchange="preview()" oninput="preview()">
                    <input class="form-control mb-2" id="ship_recip_name"     data-default="" placeholder="Name"               onchange="preview()" oninput="preview()">
                    <input class="form-control mb-2" id="ship_recip_street"   data-default="" placeholder="Street + No."       onchange="preview()" oninput="preview()">
                    <input class="form-control mb-2" id="ship_recip_zip_city" data-default="" placeholder="ZIP + City"         onchange="preview()" oninput="preview()">
                    <input class="form-control mb-2" id="ship_recip_country"  data-default="" placeholder="Country"            onchange="preview()" oninput="preview()">
                    <div class="form-check mt-1">
                        <input class="form-check-input" type="checkbox" id="ship_recip_border" onchange="preview()">
                        <label class="form-check-label" for="ship_recip_border">Border around recipient</label>
                    </div>
                </div>
            </div>
            <div class="card mt-2">
                <div class="card-header"><span class="fas fa-ruler-horizontal fa-xs me-1"></span> Layout</div>
                <div class="card-body pb-2">
                    <label class="form-label mb-1" for="ship_section_spacing">Section spacing (px, 0&nbsp;=&nbsp;auto)</label>
                    <input type="number" class="form-control form-control-sm" id="ship_section_spacing" data-default="0" min="0" max="500" value="0" onchange="preview()" oninput="preview()">
                </div>
            </div>
            <div class="card mt-2">
                <div class="card-header"><span class="fas fa-barcode fa-xs me-1"></span> Tracking Number <span class="text-muted fw-normal">(optional)</span></div>
                <div class="card-body pb-2">
                    <input class="form-control mb-2" id="ship_tracking" data-default="" placeholder="e.g. 00340434161094050724" onchange="preview()" oninput="preview()">
                    <div class="form-text text-muted mb-2">If provided, a barcode will be printed on the label. Use Code Settings to choose the barcode type.</div>
                    <label class="form-label mb-1" for="ship_barcode_scale">Barcode scale % (0&nbsp;=&nbsp;auto)</label>
                    <input type="number" class="form-control form-control-sm mb-2" id="ship_barcode_scale" data-default="0" min="0" max="200" value="0" onchange="preview()" oninput="preview()">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="ship_barcode_show_text" onchange="preview()">
                        <label class="form-check-label" for="ship_barcode_show_text">Show tracking number in barcode image</label>
                    </div>
                </div>
            </div>
        </fieldset>

        <fieldset id="groupLabelText">
            <label for="label_text" style="margin-top: 10px; margin-bottom: 0">Label Text:</label>
            <textarea rows="7" id="label_text" class="form-control" onChange="preview()" onInput="preview()"
                data-default=""></textarea>
            <!-- Template info box -->
            <div class="card mt-2" style="font-size: 0.95em;">
                <div class="card-header p-2" style="cursor: pointer; user-select: none;" data-bs-toggle="collapse"
                    data-bs-target="#templateInfoBox" aria-expanded="false" aria-controls="templateInfoBox">
                    <span class="fas fa-info-circle" aria-hidden="true"></span>
                    <span style="margin-left: 0.5em;">About label templates <span
                            class="fas fa-chevron-down float-end"></span></span>
                </div>
                <div id="templateInfoBox" class="collapse">
                    <div class="card-body pt-2 pb-2">
                        <strong>Templates</strong> allow you to insert dynamic content into your label text. Supported
                        templates:<br>
                        <ul style="margin-bottom: 0.5em;">
                            <li><code>{{'{{datetime:<format>}}'}}</code> — Inserts the current date and time when printing.
                                You can customize the format using <a href="https://strftime.org/" target="_blank"
                                    rel="noopener">strftime</a> options, e.g., <code>%H:%M:%S %d.%m.%Y</code>.</li>
                            <li><code>{{'{{counter[:<start>]}}'}}</code> — Inserts an up-counting number. You can optionally specify a <code><start></code> value (defaulting to 1) to start counting from a different number.
                                When printing multiple labels at once, the counter automatically increments for each label.
                            </li>
                            <li><code>{{'{{uuid'}}}}</code> — Inserts a random UUID (Universally Unique Identifier).</li>
                            <li><code>{{'{{short-uuid'}}}}</code> — Inserts a shortened version of a UUID.</li>
                            <li><code>{{'{{env:<var>}}'}}</code> — Inserts the value of the environment variable <code><var></code>.</li>
                            <li><code>{{'{{random[:<len>][:shift]}}'}}</code> — Inserts a random string of optional length <code><len></code>
                                (defaulting to 64). The optional <code>shift</code> parameter can be used to shift the random string around to fill gaps.</li>
                        </ul>
                        <span class="text-muted">Templates are replaced at print time.</span>
                    </div>
                </div>
            </div>
        </fieldset>
    </div>
    <div class="col-lg-4 col-md-4">
    <fieldset>
        <label for="previewImg" style="margin-bottom: 0">Label Preview:</label><br />
        <img id="previewImg" style="max-height: 350px; width: auto; max-width: 100%; display: block; margin-bottom: 1em;" />
        <p>Printed size: <span id="labelWidth">?</span> cm x <span id="labelHeight">?</span> cm</p>

        <div>
            <label for="print_count" style="margin-top: 10px; margin-bottom: 0">Print Count:</label>
            <input id="print_count" class="form-control" type="number" min="1" max="100" data-default="1" required>
        </div>

        <div class="input-group my-3 d-flex justify-content-center w-100">
            <div class="btn-group w-100">
                <button type="button" id="printButton" class="btn btn-primary btn-lg w-75" onClick="print()">
                    <span class="fas fa-print" aria-hidden="true"></span> Print
                </button>
                <button type="button" class="btn btn-primary btn-lg dropdown-toggle dropdown-toggle-split" style="width: 25px; min-width: 0;" id="dropdownPrintButton" data-bs-toggle="dropdown" aria-expanded="false">
                    <span class="visually-hidden">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownPrintButton" style="min-width: 100px; width: max-content;">
                    <li><a class="dropdown-item" href="#" onClick="print(true)">Cut only once</a></li>
                </ul>
            </div>
        </div>
    </fieldset>
    <div class="card">
        <div class="card-header">
            <span class="fas fa-terminal" aria-hidden="true" style="margin-right: 0.3em"></span> Status
            <span id="statusIcon" class="float-end fas fa-exclamation-triangle" aria-hidden="true"></span>
        </div>
        <div id="printerStatusPanel" class="card-body" style="display: none;">
            <div id="printerStatusBox" class="alert alert-secondary" role="alert"></div>
        </div>
        <div id="statusPanel" class="card-body">
            <div id="statusBox" class="alert alert-secondary" role="alert"><span>Idle...</span></div>
        </div>
    </div>
</div>
<!-- Repository Modal -->
<div class="modal fade" id="repoModal" tabindex="-1" aria-labelledby="repoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="repoModalLabel">Label Repository</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3 d-flex gap-2">
                    <input id="repoSaveName" class="form-control" placeholder="Enter name to save current label...">
                    <button id="repoSaveBtn" class="btn btn-primary">Save</button>
                </div>
                <div id="repoListBody">
                    <p class="text-muted">Loading...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
const url_for_print = '{{ url_for('.print_label') }}';
const url_for_preview = '{{ url_for('.preview_from_image') }}';
const url_for_get_barcodes = '{{ url_for('.get_barcodes') }}';
const url_for_get_printer_status = '{{ url_for('.get_printer_status') }}';
const default_dpi = {{ default_dpi }};
const url_for_repo_list = '{{ url_for('.repo_list') }}';
const url_for_repo_save = '{{ url_for('.repo_save') }}';
const url_for_repo_load = '{{ url_for('.repo_load') }}';
const url_for_repo_delete = '{{ url_for('.repo_delete') }}';
const url_for_repo_preview = '{{ url_for('.repo_preview') }}';
const url_for_repo_print = '{{ url_for('.repo_print') }}';

{{ super() }}
{% endblock %}
